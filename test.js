const { Signer } = require('./signer')
const { keyFromPem, extractPubkey2 } = require('./utils')
const { Verifier } = require('./verifier')

// devnet
const masterPem = `-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC6HH82NIk1cm+OGE1mvNewjM4wJjwmI4lfctbY+6+5LGw9qfJ6jQX0/na8eSBQPnhooiTIqxNHKTarP5q9Ca4wih9ns4qOT6o9U00fsx4fgTLNArdVAETuhpbxgnfCnMZ/H7ktoacKVQQYArU1GGiWCSAgB47QOBW6dJlXlfPFSe29nIEPc+mm+UXW2xq/iZfxY9f92ALvMw84hoQv7CmpkAi1qw/8n+DD03ruxBZz0FI7fxgqY/vrKXqFu/0n7H2jAokTGKZHGUHwPNvLrDJ0P7Y1+h2/C1Y8n40EiEf+TutSWfhTUwnU5Rz82m4IMThSqxrj6QN2QXJ49wB56XObAgMBAAECggEAQaED8RL0oZ7RnNuQC98i9lSo7wzEoDRe4IRIJCsY6+Uw5EvWQIYTaDIFn+/cx79HyaoH66V8PldXumrK/8d2oBJNAc4r2YRZRZfm9fs9b6GpTucazEQ0iqJ2fwLhhYSwcKq4q9E57OhO8cKesPMDCol8RR81KtLkQqSUYHD2DgcpINaL1SFZNn9RcrOs53Ma1b27WOt+TivUDOLsAt9AvtVuzr5S2jUjnLVvNngGbmamotfuhDYAV9SzeYiwFOpfPnsw+4Lq7egWVXGfUZcR962xxzjvDaGuNUsif8rcTMxKl9aywYWfPNMUByeCmspbf+eWqp11VHWevrDVfyxQEQKBgQD5Ba6uzKb25dS3lkU3acigKHFKk5JXtSdraO0cEEcYHCqVJFBUBW3zZ0eMFQkFY4WJFJDGIy11A9w3LVvd3PbT2Hm/H5zXgzIAhCGS4YLmcBVn3Zrg8HHdlYxknUaJ57JjQceAtQ/RcidMdcGdx6IX+4sOTv99qEpyXT8Yn0OZ6wKBgQC/U4jEfXD8qMGGpcZFqoFl7Wsgfb37RkBGv7WTxSbvwTmAQqTRTjZSQSWH0oiPqnxu9LYtVr9JIh8P6T3TbeoO31O1DqbPYclmWQx4v9HkOygDdtIpHGt91kmktnGfbi0DSUdaAwzLhmPWAiRokOy5wFdVsdEagvS+cz5/UBLxEQKBgQDelXCtN6op2AcJzhyySjCUz3FsWnmdQgQpItGFmxsg9tQtGRdf8rZzsSYnlQnKMknC3IoHQJw6Eqg8/aM2rXJGqyEvb39OtyrzgSdNVZsehKLtgwwT8Xeluy2RJW9OhrZRuBMt/SlVafashjj44d8GFsYVlRETbWCV1rk2Ne1D3wKBgEsscTJy7y/2xoM3I15ADjOUQ2EyxrCx+5NQw/FZp2DQlN02UjgC+Qj8m9hv+kQogle+Qs4xpVsA0x+XTzmBmFNboDIlnZkiHNXf6yyOgdOhAqnJx+1rQzjgN3NGVAKGcZ0275gIVsCo/xUZJmEHgFvDnQ0IntZB2hPyh/3R4n9hAoGBAIZZHGa9X8PzspJUjyuvn2k/HQIj8hsymtCJPbzTc4NSqlIj2EfrN07WhoaT81bfZ4NGMgIE/2UCbk4iUJNJUJrg8UHQscIXJajd4pBESbVcPgPH2nbNpW5qKDrL5fWA4AGjoWqeGnnb1aUPMllS1rbjVdnb3RzVblre6V4lGNaD
-----END PRIVATE KEY-----`
const localPem = `-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDYMAdGVwEdVFgl5Qbv2Ok5j1H1rXZs+wvYo8KRp877fgICilublHbZL0DEq9oL102gsGiSuHHy9jubXAIGctFMnGChrEHKOxZiakwAeWoS2yO1qjoEkB3F54Gi/SNEiUVWCTwa1CAeRkXt+hIAytaRnAEUtTguL5Trr5kD1DkJ3qR0xE+SO7+TZ/OQN+vuAM/j030NMp/WErxRZioCcRnGoPZTQz3840F06W+4605PlMQ7Kk3yRJyntzlbOxbQ35x7ZH5ZUz8gTcTrFndzf9Jv/0hsTOhrlmT4d96uh+slMJmVl/t3GLoQy6oHUYJfF4B/ZiGP++KrGD2cNi73KCCZAgMBAAECggEAEwGf9htqletHJ6e7xSTvFjgnNr/2GC03FKgLEFauQBaLMzF6TdKO41e/7DqGnEFkygKQYwvTus5Snb1IUUxRYdiitzwHebHZrTPWtDj4bil1eYB6gtGvyGkq0MtMCTe/UInVzq8FFtxLRBmW8RpkJF+QicNH6emVgGYLABbtn9QZdQNz1k9fnW0JvXFcw5WznRtQRMclNOApHZFBPRlp+Cs4F1Nd3lp3m0+Pfy190qMb+kDFAzb5UM1i0P18X/EswbII/7wtyP9VT0OJ4BSHjsGxsiSz8SmzkM+Xm+XZaY9hKnsmcLsXtYeI/S5MOyHCacB+1KRAE0bNJbiDhcW1nQKBgQD51vr8DiBxmqqQM+oMx6sMBK4y+XEapG3pfDU7CFLlifeFVIA3SP2YIh45sPQwhi4b+zg1TyE9+KAQmU5SL1TH6vgWIw3XyIwC1W8HiPy1hF83a7iLgZFjqN/LhtYChdBH7BF0j7tYvo/n1iTQxwuEosX1s9II4S1LbBe8YyDJBQKBgQDdhKGlGhAWzvTxEBQOzeWRc3hyieEiM2p2wwCfm40RO5koMW0TthIHCcOcXgGfzuQoj7XhaQjBHppp/657XhrjiwujkiKitLCmUnE8gRIV68IrVba3IxtghqA4aS1KbiJAAdFlh8JOxujLR5xO5MpkAehEmhooL5p8J/sdOYu9hQKBgQCpyZnD1e3ihpPHcCBtEvyBLGUeKzrcOkaf2FNsjNmZOMvIBockCyycSQN1fXZVy7pmNbIbOG2E6gQNg8IgRB4/xsVWdfggXyAXhOjxm/zxdsYmqcQ+uo0Nx2RfsoCaMko7toieSFevlcHCcluOrtZ7CwuxUMU6V50qlokC8/MB6QKBgFaZpGwcTU/tZrrbU0waWHZNkzgMCTTKrwNw5sx/Dl4/U3fwIrmDA3c27P8zjSUByBbHYA6YdnCxWyK3b2oRdyef01QGLH45b5oGPvitaPmi6ozwfHcKRYit+PM0wx0HA2LMkyVDNsZ/YsEd5NC/BxSj3j77k+BEA/wn0TcyqRvVAoGBALPmTYS9Vgx3U3WEkPVvHKdXG1kYkOsmQOA8fm7BL1lo00VtfVjkoc0uXij9yjSEfcXM6PjEnLUsPkohK9AiTuCSkcKfIjH5qdjcQGs54X+Vatf/Rk10qew4bFGPVmWrroLRJRyGPFrqnadEiHMWmkkPx1q7Ia14r0vH4nfYdsCi
-----END PRIVATE KEY-----`

async function test() {
  const masterKey = keyFromPem(masterPem)
  const localKey = keyFromPem(localPem)

  const masterPubkey = await extractPubkey2(masterKey)
  const localPubkey = await extractPubkey2(localKey)

  // sign message
  const signer = new Signer()
  signer.setKeys(masterKey, masterPubkey, localKey, localPubkey)

  const message = 'hello world'
  const messageHex = Buffer.from(message).toString('hex')
  const sig = signer.rsaSign(messageHex)
  console.log('sig', sig)

  // verify message
  const verifier = new Verifier()
  verifier.verify(messageHex, sig)
}

test()
